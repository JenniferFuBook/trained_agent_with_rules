# ============================================
# Docker Compose Configuration for GPT-2 Training
# ============================================
# This file defines how to run the training container.
#
# Usage:
#   docker-compose build    # Build the container image
#   docker-compose up       # Run training
#   docker-compose down     # Stop and remove container

services:
  trainer:
    # ============================================
    # Build Configuration
    # ============================================
    build: .  # Build from Dockerfile in current directory

    # ============================================
    # Volume Mounts
    # ============================================
    # Mount folders from your computer into the container
    # Format: ./host-path:/container-path
    volumes:
      - ./agent-trained:/app/agent-trained  # Trained model saved here
      - ./data:/app/data              # Your training text files

    # ============================================
    # Environment Variables
    # ============================================
    # These prevent threading issues during training
    environment:
      - OMP_NUM_THREADS=1              # Limit OpenMP threads
      - MKL_NUM_THREADS=1              # Limit Math Kernel Library threads
      - TOKENIZERS_PARALLELISM=false   # Disable tokenizer parallelism

    # ============================================
    # Resource Limits
    # ============================================
    # Allocate memory to the container
    deploy:
      resources:
        limits:
          memory: 4G      # Maximum 4GB of RAM
        reservations:
          memory: 2G      # Reserve at least 2GB of RAM
